# Changelog
All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.7.3] - 2024-04-08
### 修正
- アウトラインの頂点が削除される場合に深度の書き出しが正しく動作しない問題を修正
- `Remove Unused Texture`で一部テクスチャが残る問題を修正
- 最適化でIDMaskPriorが正しく動作しなくなるのを修正
- マテリアルの色を完全な黒に設定したときに最適化時にシェーダーが正しく動作しなくなるのを修正
- RimShadeのマスクが正しく動作していないのを修正
- RimShadeがプリセットに保存されないのを修正
- 一部シェーダーキーワードをビルド時にセットするように修正

## [1.7.2] - 2024-01-18
### 修正
- Unity 2019でトグルがうまく動作しないのを修正

## [1.7.1] - 2024-01-17
### 修正
- UIの不具合を修正

## [1.7.0] - 2024-01-17
### 追加
- UV Tile Discardを追加

### 修正
- マテリアルのバージョン取得が正しくなかったのを修正
- lilcontainerにシェーダーコードのテキストを追加

## [1.6.0] - 2023-12-31
### 追加
- RimShadeを追加

### 修正
- AssetPostprocessorが正しく動作していなかったのを修正
- シェーダーキーワードの非互換による不具合を回避

## [1.5.2] - 2023-12-30
### 修正
- AssetBundleビルド時に必要な頂点データが消されてしまう場合があるのを修正

## [1.5.1] - 2023-12-27
### 修正
- 特定Unityバージョンにおけるクラッシュ問題を回避
- マテリアルバリアントへの対応
- マテリアルのマイグレーションを発生しにくくした

## [1.5.0] - 2023-12-10
### 追加
- altキーでプロパティ名を見られるようにした
- IDMaskをbitmapとして扱うモードとDissolve対応
- 最適化を強制的に無効化できる`LILTOON_DISABLE_OPTIMIZATION`シンボルを追加
- `Assets/lilToon/[Material] Run migration`を追加

### 変更
- Temp配下に一時ファイルを生成しなくなった

### 修正
- 透過モードのラベルが壊れていたのを修正
- URPでMotionVectorが正しく出力されていなかったのを修正
- UnityがUVチャンネルを過剰に削除してしまうのを回避
- 複数編集時の不具合を修正
- 色調補正のベイクが正しく動作していなかったのを修正

### 削除
- `IPreprocessShaders`による最適化を削除

## [1.4.1] - 2023-09-04
### 修正
- ボーンが不足している場合に`Fix Lighting`が正しく動作しないのを修正
- 一部プロパティがプリセットに保存できないのを修正
- カスタムシェーダーでTEXCOORDが重複するのを修正
- スケールの変更でテッセレーションが正常に動作しない問題を修正
- URPの`DepthOnly``DepthNormals``MotionVectors`パスでステンシルを使うように修正

## [1.4.0] - 2023-05-12
### 追加
- 頂点IDによるマスクを追加
- Ditherを追加
- メインカラー2nd・3rdに透明度の置換機能を追加
- プロパティの検索機能を追加
- AudioLinkのマスクにUV設定を追加
- 距離フェードにリムライトを追加

### 修正
- lilToonMultiの変換を修正
- lilToonLiteのエディタエラーを修正
- アニメーションやマテリアルがサブアセットである場合の検知を修正
- VRCSDK3をVersion Definesを使って検知するように変更
- UPMでインポートした場合に設定のロックが正しく機能しないのを修正
- UPMでインポートした場合のプリセット保存ディレクトリを修正
- 発光効果が正しく反映されていなかったのを修正
- メインカラー2nd・3rdにテクスチャをセットしていない場合にデカール化されないのを修正
- SLZURPの正しいバージョンが取得できないのを修正
- URPのバリアント削減機能と競合していた問題を回避
- アルファマスクを置換モードに設定した場合にシェーダーエラーになる可能性があった問題を修正
- Unity 2018でスクリプトエラーになっていたのを修正
- `Fix Lighting`でBoundsが過剰に大きくなるのを修正
- MToon変換時に`_Color`がクランプされるように修正
- `VR時に非表示`がオンの場合に正しく深度が出力されないのを修正

### 変更
- csc.rspをasmdefと同一階層に移動

## [1.3.7] - 2023-01-17
### 追加
- `VRChat Package Manager`のサポート
- `SLZURP`のサポート
- リムライトと発光に`合成モード`を追加
- `アンチエイリアスシェーディング`プロパティを追加

### 修正
- FakeShadowのエラーを修正
- ファー（カットアウト）のAOを修正
- 屈折ぼかしの強度がFOVに依存していた問題を修正
- 最適化後の値を修正
- URP 14.0.4のForward+でエラーになる問題を修正

## [1.3.6] - 2022-09-10
### 修正
- シェーダープロパティの文字列化のバグを修正
- 屈折シェーダーのUVを修正
- ローカライゼーション対応漏れを修正

## [1.3.5] - 2022-09-06
### 追加
- LightModeのオーバーライドを追加
- アルファマスクに`Tiling & Offset`と`合成モード (加算 / 減算)`を追加
- 影色のサンプリング方法に`LUT`を追加
- URPの`Forward+`をサポート
- 発光をライトベイクに反映するオプションを追加
- `シェーダー設定`のロックを追加
- バグレポーターを追加（`GameObject/lilToon/[Debug] Generate bug report`）

### 修正
- VRChatのワールドSDKでのエラーを修正
- `頂点ライトの強度`が無視されていたのを修正
- カスタムシェーダーが最適化時にスキャンされていなかったのを修正
- URPのライトレイヤーを修正
- `ScalableBufferManager.ResizeBuffers()`で解像度が変更された際のUV計算を修正

## [1.3.4] - 2022-07-30
### 追加
- cluster用プロジェクトでGrabPassやジオメトリシェーダーを用いたバリアントを使用しているときの警告を追加
- ChilloutVRのアバタービルド時にも最適化を行うようにした

### 修正
- 一部スクリプトエラーになることがあるのを修正
- 最適化後の色の値を修正
- ForwardAddパスのライティングを修正
- URPでビルド後に追加ライトが動作しない問題を修正

## [1.3.3] - 2022-07-27
### 追加
- ラメのマスクに`UV Mode`を追加

### 修正
- メインカラー2nd・3rdのDissolveが最適化時に正しく動作しなくなる場合がある問題を修正
- 一部条件で最適化時にうまく動作しないことがあるのを修正
- URPでの環境光の扱いを修正
- Mac環境で改行コードが混在する問題を修正
- lilToonMultiのエラーを修正
- OpenGL環境でスタートアップ時のシェーダー書き換えが正しく動作していなかったのを修正

## [1.3.2] - 2022-07-20
### 追加
- ノーマルマップ2ndに`UV Mode`を追加
- メインカラー2nd・3rdに`Cull Mode`を追加
- 輪郭線のハイライトに`影を受け取る`を追加
- 2パス透過シェーダーを拡張
- VRChatのアバタービルドで変数を定数化する機能を追加
- 古いパッケージをインポートしようとした際のダイアログを追加

### 変更
- ノーマルマップ2ndのサンプラーを`Repeat`に変更
- HDRPでポイントライト・スポットライト・エリアライトの計算をピクセルシェーダーに移動し、ライト方向の計算も行うようにした
- GUIを微調整
- ビルド時間を最適化
- `lilToonSetting.json`でフォーマットを行うようにした
- 2パス透過シェーダーでForwardAddパスを使用するように変更
- テクスチャベイク時のファイル名を統一

### 修正
- 宝石シェーダーのGUIのエラーを修正
- マットキャップ2ndのマスクがRチャンネルのみ使用されていたのをRGBチャンネルを使うように修正
- ツールチップの表記を修正
- `Fix Lighting`でマテリアルに対して修正が適用されていなかったのを修正
- シェーダー最適化時にDissolveが削減される場合があったのを修正

## [1.3.1] - 2022-06-28
### 追加
- VRChatのアバターのテストビルド時に最適化を行わないようなオプションを追加

### 修正
- メインカラー2nd・3rdでテクスチャのインポート設定がClampになっている場合にうまく描画できない問題を修正
- エディタ上のAPIに`OpenGLES2`、`OpenGLES3`、`OpenGLCore`を使用している場合のテクスチャ数不足を修正

## [1.3.0] - 2022-06-25
### 追加
- 2影・3影に`影を受け取る`を追加
- 影のマスク方法に`Flat`を追加
- 輪郭線に`Z Bias`と`ハイライト`と`太さ0の頂点を削除`と`VR時に非表示`を追加
- レンダリング設定に`Shadow Caster Bias`を追加
- ファーのメッシュ分割方法を追加
- 反射に`GSAA`と`合成モード`を追加
- 影の強度、ぼかし、AOテクスチャに`LOD`を追加
- 逆光ライト、マットキャップ、リムライト、発光に`メインカラーの強度`を追加
- ラメに形状の`マスク`、粒子サイズの`ランダム化`を追加
- 裏面を単色で塗りつぶす機能を追加
- 金属のMatCap素材、プリセットを追加
- CircularのTangent Map素材を追加
- ラメの形状テクスチャを追加
- 古いバージョンで上書きした場合のエラーを回避
- カスタムシェーダー機能の拡張
- 2パスファーシェーダーのURPとHDRP対応

### 変更
- アルファマスクのGUIを向上
- 輪郭線の`距離に応じた太さ補正`を無段階で調整可能に
- `ライト方向のオーバーライド`の初期値を調整
- シェーダー設定を自動化
- `ライティングを適用`を`ライトの明るさを反映`に名前変更
- ラメの`コントラスト`を`密度`と`感度`に分割
- POMをパラメーター化
- プリセット機能を拡張
- `Setup from FBX`で使用するプリセットをシェーダー設定内に保存するように変更
- `Fix lighting`で`ライト方向のオーバーライド`のマテリアルの設定が保持されるように変更
- ファーのプリセットを再調整
- いくつかのプロパティの表示名で`背面`になっていた部分を`裏面`に統一
- URPのSpot Light、Point Lightでのライティングを改善

### 修正
- URPでフォグがうまく動作していなかった問題を修正
- テクスチャにPNG/JPGフォーマット以外を使用していた場合のテクスチャベイク処理を修正
- `_MainTex`プロパティに`[MainTexture]`を追加
- `ライト方向のオーバーライド`がShadeSH9の計算に影響していた問題を修正
- lilToonMultiでビルドサイズ削減が適用されすぎていた部分を修正
- lilToonLiteでアウトラインマスクがうまく動作していなかったのを修正

### 削除
- Unity 2017のサポートを削除

## [1.2.12] - 2022-03-31
### 修正
- `Unity 2019.4.10f1`以前でカスタムシェーダーがエラーになる問題を修正
- カスタムシェーダーでForwardAddパスがうまく動作しない問題を修正

## [1.2.11] - 2022-03-28
### 追加
- AO Mapに`影範囲設定を無視して適用`を追加（影のトゥーン処理後にAO Mapを合成）
- ラメに`コントラスト（後処理）`を追加
- メインカラー2nd・3rdに`UV Mode`を追加
- 輪郭線に頂点カラーを利用して法線方向を決める機能を追加
- カスタムシェーダー用に独自フォーマットを追加

### 変更
- 開発者向けドキュメントの内容をドキュメントサイトに移行
- 古いカスタムシェーダー用テンプレートを削除

### 修正
- lilToonMultiのForwardAddパスで影が適用されていなかったのを修正
- 宝石シェーダーでリムライトやマットキャップの`ノーマルマップ強度`がうまく動いていなかったのを修正
- ポイントライト・スポットライト環境下のファーの見た目を修正
- 2パスファーのZファイティングを修正
- テッセレーションシェーダーが視界端でポリゴンが消える場合があるのを修正
- URP、HDRPのVR環境での挙動を修正
- `Remove unused properties`の方式をSerializedObject経由に変更

## [1.2.10] - 2022-03-06
### 追加
- 複数シェーダーバリエーションを同時に編集できるウィンドウを追加（`Window/_lil/[Beta] lilToon Multi-Editor`）

### 変更
- Near clipが極端に大きい場合（意図的に消している場合）に`距離クリッピングキャンセラー`を無効化するようにした
- `UnpackNormalScale()`を`lilUnpackNormalScale()`に置き換え
- SHライトの方向を補正するように変更

### 修正
- ファーシェーダーでノーマルマップのスケールが適用されていなかった問題を修正
- いくつかのプロパティの同時編集の修正
- lilToonMultiで変更したRenderQueueがUnityEditorの再起動時に元に戻る問題を修正
- Remove Unused PropertiesでCustom Safety Fallbackの設定がコピーされない問題を修正
- `VRCFallback`タグが保存されない場合があるのを修正

## [1.2.9] - 2022-02-04
### 追加
- Cubemapのフォールバック・オーバーライド機能を追加
- MatCapのUV設定に一括設定ボタンを追加

### 変更
- シェーダー設定をタブとして再配置

### 修正
- `Fix lighting`が右クリックメニューに表示されていなかった問題を修正
- 屈折シェーダーがForwardAddで明るくなりすぎていたのを修正

## [1.2.8] - 2022-01-30
### 追加
- 3影を追加
- ファーに`ランダム化`プロパティを追加
- ファーに通常のシェーダーと同じプロパティを追加
- `イベント入稿用に最適化`ボタンとビルド時に自動でシェーダー設定を最適化する機能を追加（ワールド用VRCSDK導入時のみ）
- シェーダーキーワードを使用するシェーダーのビルドサイズを削減
- 2パス（カットアウト+透過）ファーシェーダーを追加
- `[lilToon] Fix Lighting`で適用されるマテリアルのパラメーターの初期値の設定を追加
- ビルドサイズ削減用のシェーダー設定を追加
- ライト方向のオーバーライドに`オブジェクトに追従`を追加

### 変更
- 影のぼかし量マスクでGチャンネルを影色2のぼかし量として使えるように変更
- lilToonMultiの距離クリッピングキャンセラーをパラメーター化
- 透過ファーシェーダーでもスポットライトの形状を考慮するようになった
- アウトラインにも加算パスを適用するように変更
- `頂点ライトの強度`の初期値を0に変更
- `明るさの下限`の初期値を0.05に変更
- ライティングプリセットの名称を`安定`から`半モノクロ`に変更
- 加算パスでも影を計算するように変更
- UIを微調整
- シェーダー設定のメニューを折りたたんだ際に自動でシェーダー設定を適用するように変更（押し忘れ対策）
- カットアウトの値の範囲を-0.001～1.001に変更
- 右クリックメニューを整理
- 輪郭線がDOFでボケないようにした

### 修正
- 加算パスで`ライトの上限`が変更できていなかったのを修正
- ぼかし屈折シェーダーのぼかし具合がClipping距離で変わってしまっていたのを修正

## [1.2.7] - 2021-12-13
### 追加
- 輪郭線を押し出す方向を調整できるノーマルマップを追加
- 輪郭線のみ、ファーのみのシェーダーを追加
- リムライトにVR時の視差の強さを調整する機能を追加

### 変更
- Render Queueを基本設定にも表示
- HDRPでステンシルを無効化
- HDRPでファーの影が濃く出るように変更

### 修正
- Single Pass Instanced環境での屈折シェーダーの動作を修正
- HDRPでの透過シェーダーのRender Queueを修正
- HDRPでのモーションベクターの出力を修正

## [1.2.6] - 2021-12-01
### 追加
- いくつかのテクスチャにカスタムUVを追加
- 各機能に`ノーマルマップ強度`プロパティを追加
- マットキャップに`ぼかし`プロパティの追加
- アルファマスク、AOマスクに調整用プロパティを追加
- AudioLink非対応ワールドでの挙動調整用のプロパティの追加
- AudioLinkにスペクトラム表示を追加
- VRChatでセーフティー発動時のシェーダーのフォールバック先をカスタマイズする機能の追加

### 変更
- AOマップでGチャンネルを影色2の範囲として使えるように変更
- マットキャップのマスクでRGBチャンネルそれぞれを使えるように変更
- シェーダー設定から負荷に影響がほぼなかったカスタムUVを削除し常に有効化するように変更
- 汎用サンプラーをTrilinear化

### 修正
- 屈折シェーダーのForwardAddパスで透明度が反映されていなかったのを修正
- 屈折・宝石シェーダーの描画を修正
- テッセレーションシェーダーでフォグの処理がうまくできていなかったのを修正
- HDRPでのLiteバージョンのMatCapのUVのプロジェクションを修正

## [1.2.5] - 2021-11-21
### 修正
- ファーシェーダーでフォグの処理がうまくできていなかったのを修正

## [1.2.4] - 2021-11-20
### 追加
- 光沢のタイプのトゥーンに`範囲`と`ぼかし`プロパティを追加
- 発光に様々なUVモードを追加
- カスタムシェーダー作成時のappdata構造体の入力に`uint vertexID : SV_VertexID`を追加
- Light Layersに対応 (URP)

### 変更
- マテリアル・アニメーションからシェーダー設定をスキャンする機能のダイアログの表示タイミングを変更
- GUIを微調整
- interpolatorを削減
- トゥーンの光沢のタイプのアルゴリズムを変更
- lilToonMultiの輪郭線スキップ時の関数を変更

### 修正
- AudioLink非対応ワールドの判定がうまくできていなかった問題の修正
- ファーシェーダーで環境光の強度プロパティが適用されていなかったのを修正
- lilToonMultiの透過ファーシェーダーで描画モード切り替え時にZWriteがオフになっていたのを修正
- UVのスクロールと回転を併用した際の挙動を修正

## [1.2.3] - 2021-10-30
### 追加
- マットキャップのUV関係の機能を拡張
- 異方性反射を追加
- メインカラーのプロパティを_BaseMapと_BaseColorMapと_BaseColorにも保存されるように変更
- `複数ライトから光沢を生成`プロパティの追加
- マットキャップ、リムライト、ラメ、逆光ライトに`裏面で無効化`プロパティの追加

### 変更
- Stencil設定ボタンでOpaqueマテリアルのRenderQueueをAlphaTestに合わせるように変更

### 修正
- プリセットのRenderQueueがうまく適用されていなかったのを修正
- ファーのマスクをファーの処理後に適用されるように修正
- UPM版でシェーダー書き換えが適切に行われていなかった問題の修正
- ローカライゼーション対応漏れを修正
- HDRPでExposure使用時、Planer Reflection内で暗くなる問題を修正 (HDRP 11.0.0以降)
- 距離フェード機能に視差が発生しないように修正

## [1.2.2] - 2021-10-18
### 追加
- ライティングの設定をワンクリックで切り替える機能の追加

### 修正
- マットキャップのカスタムノーマルマップが機能していなかった問題の修正
- 遠距離でテッセレーションの分割が入る問題の修正
- シェーダーの自動設定で一部プロパティがスキャンされない可能性があった問題の修正

## [1.2.1] - 2021-10-17
### 修正
- ファーの長さプロパティが機能していなかった問題の修正
- ログの日付を修正

## [1.2.0] - 2021-10-17
### 追加
- HDRPに対応
- `明るさの上限`、`ライトのモノクロ化`、`ライト方向のオーバーライド`プロパティの追加
- 逆光ライト機能の追加
- ファーシェーダーに`根本の太さ`プロパティの追加
- マットキャップに`影部分で無効化`、`視差の強さ`プロパティの追加
- プロパティブロックにメニューを追加 (プロパティを一括コピー、ペーストできるようになりました)
- 裏面のUVをずらす機能を追加
- 透過シェーダーのバリエーションに1パス・2パスの追加
- シェーダーキーワードを利用するバリエーションの追加 (_lil/lilToonMulti)
- プリセット保存画面を開いている状態でマテリアルを選択した際の警告を追加
- カスタムシェーダー作成用のマクロを追加
- カスタムシェーダーのテンプレートを追加

### 変更
- 透過シェーダーのRenderQueueを2460に変更 (ステンシル用に余裕を持たせた)
- 屈折シェーダーのRenderQueueを2900に変更 (透過マテリアル越しの透けを回避)
- 屈折の強度に負の値を設定可能に変更
- 画面端でもマットキャップのUVが正面になるように変更
- `透過モード`を`描画モード`に改名
- 影設定の`メインカラーの強度`を`コントラスト`に改名
- `AlphaToMask`の切り替えに対応
- 透過シェーダーの`RenderType`を`TransparentCutout`に変更
- `影色への環境光影響度`のデフォルト値を0に変更
- 変更ログを`CHANGELOG.md`と`CHANGELOG_JP.md`に移動

### 修正
- PlayモードでParent Constraintが編集できない問題を修正
- 屈折シェーダーが特定条件下で一部アセットに干渉する可能性がある問題の修正
- メインテクスチャのSamplerStateをうまく取得できていなかった問題の修正

### 削除
- いくつかのhlslファイル

## [1.1.8] - 2021-08-31
### 追加
- 宝石シェーダー、FakeShadowシェーダーの追加
- ラメにUV1を参照するモードを追加
- ラメにVR時の視差の強さを調整する機能を追加

### 修正
- 発光のカラースペースを修正
- インポート時にラメのプロパティがスキャンされない問題を修正
- AvaterEncryption使用時に一部パスでメッシュが復号化されない問題を修正

## [1.1.7] - 2021-08-29
### 追加
- HDRカラーピッカーの隣にカラーコードを追加 (Unity2019以降)
- メインカラーの色調補正にマスクを追加
- メインカラー2nd・3rdに距離フェードを追加
- ラメ機能の追加

### 変更
- メインカラーのカラーピッカーをHDR化
- 行列計算の変更
- いくつかの処理を頂点シェーダーに移動し最適化

### 修正
- UPMインポートの修正
- `距離フェード`と`Dissolve`の透過を修正
- Unity 2019のURPでうまく動作しない問題を修正

## [1.1.6] - 2021-08-17
### 追加
- ヘルプボックスに自動修正ボタンを追加

### 変更
- 輪郭線のZTestのデフォルト値をLessEqualからLessに変更

### 修正
- 明るさの下限設定で影が弱くなる問題の修正

## [1.1.5] - 2021-08-08
### 追加
- `困ったときは…`を追加
- マットキャップのZ軸回転キャンセル機能のオンオフを追加

### 変更
- 透過処理を改善
- UIを整理

### 修正
- フォルダを移動可能にしました
- 不透明マテリアルにアルファマスクのプロパティが存在していた点を修正
- 一部翻訳を修正

## [1.1.4] - 2021-07-31
### 追加
- unitypackageインポート時のマテリアル・アニメーションの自動スキャン機能を追加
- `Auto shader setting`を追加、プロジェクト内の全マテリアル・アニメーションをスキャンし自動でシェーダー設定を最適化します
- `Remove unused properties`を追加、シェーダー設定を追加でオンにしても見た目に影響が出ないようにマテリアルを最適化します
- `Setup from FBX`を追加、FBXファイルから自動でマテリアルの生成、プリセットの適用、輪郭線マスク、影マスクの適用を行います
- ファーシェーダーに長さ調整用のマスクを追加
- `シェーダー設定`のロックを追加

### 変更
- 一部プロパティの表示名の変更 (`環境光の強さ`→`影色への環境光影響度`、`太さを補正`→`距離に応じた太さ補正`)
- 再生ボタンを押してもInspectorの状態が維持されるように変更
- ファーシェーダーの`Unlit化`のプロパティをスライダー化

## [1.1.3] - 2021-07-24
### 修正
- バージョンチェック失敗時にInspectorが表示されない問題の修正
- `[lilToon] Fix Lighting`でClothコンポーネントがある、もしくはボーンが無い場合に壊れる問題の修正

## [1.1.2] - 2021-07-20
### 追加
- マットキャップにカスタムノーマルマップを追加
- リムライトにライト方向によるカスタマイズ機能を追加
- メッシュ・マテリアルのライティングを一括設定する機能を追加

### 変更
- 輪郭線の太さに任意の値を設定可能に
- アルファマスクが輪郭線にも適用されるように変更

## [1.1.1] - 2021-07-16
### 追加
- シェーダーリフレッシュの追加
- プロパティのアルファが0のときに警告を表示

### 修正
- エディターのテーマ変更に対応

## [1.1] - 2021-07-15
### 追加
- アルファマスクの追加
- マットキャップ2ndの追加
- 明るさの下限や頂点ライトの強度を調整可能に
- 負荷が比較的高い機能に警告を追加 (屈折・POM)

### 修正
- URPにおいてCascadeShadowがうまく動作していなかった点
- マットキャップの"ライティングを適用"が正しく動作していなかった点
- 参考文献の追記

## [1.0] - 2021-07-12 [YANKED]